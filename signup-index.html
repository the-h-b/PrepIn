#include <stdio.h>
    #include <string.h>
    
    #define MAX_SYMBOLS 20
    
    struct node {
        // storing symbol
        char sym;
        // storing probability or frequency
        float pro;
        int arr[MAX_SYMBOLS];
        int top;
    };
    
    typedef struct node Node;
    
    // function to find shannon code
    void shannon(int l, int h, Node p[])
    {
        float pack1 = 0, pack2 = 0, diff1 = 0, diff2 = 0;
        int i, d, k, j;
        if ((l + 1) == h || l == h || l > h) {
            if (l == h || l > h)
                return;
            p[h].arr[++(p[h].top)] = 0;
            p[l].arr[++(p[l].top)] = 1;
            return;
        }
        else {
            for (i = l; i <= h - 1; i++)
                pack1 = pack1 + p[i].pro;
            pack2 = pack2 + p[h].pro;
            diff1 = pack1 - pack2;
            if (diff1 < 0)
                diff1 = diff1 * -1;
            j = 2;
            while (j != h - l + 1) {
                k = h - j;
                pack1 = pack2 = 0;
                for (i = l; i <= k; i++)
                    pack1 = pack1 + p[i].pro;
                for (i = h; i > k; i--)
                    pack2 = pack2 + p[i].pro;
                diff2 = pack1 - pack2;
                if (diff2 < 0)
                    diff2 = diff2 * -1;
                if (diff2 >= diff1)
                    break;
                diff1 = diff2;
                j++;
            }
            k++;
            for (i = l; i <= k; i++)
                p[i].arr[++(p[i].top)] = 1;
            for (i = k + 1; i <= h; i++)
                p[i].arr[++(p[i].top)] = 0;
    
            // Invoke shannon function
            shannon(l, k, p);
            shannon(k + 1, h, p);
        }
    }
    
    // Function to sort the symbols
    // based on their probability or frequency
    void sortByProbability(int n, Node p[])
    {
        int i, j;
        Node temp;
        for (j = 1; j <= n - 1; j++) {
            for (i = 0; i < n - 1; i++) {
                if ((p[i].pro) > (p[i + 1].pro)) {
                    temp.pro = p[i].pro;
                    temp.sym = p[i].sym;
    
                    p[i].pro = p[i + 1].pro;
                    p[i].sym = p[i + 1].sym;
    
                    p[i + 1].pro = temp.pro;
                    p[i + 1].sym = temp.sym;
                }
            }
        }
    }
    
    // function to display Shannon codes
    void display(int n, Node p[])
    {
        int i, j;
        printf("\n\n\n\tSymbol\tProbability\tCode");
        for (i = n - 1; i >= 0; i--) {
            printf("\n\t%c\t\t%.2f\t", p[i].sym, p[i].pro);
            for (j = 0; j <= p[i].top; j++)
                printf("%d", p[i].arr[j]);
        }
    }
    
    // Driver code
    int main()
    {
        int n, i, j;
        float total = 0;
        char ch;
        Node p[MAX_SYMBOLS], temp;
    
        // Input the number of symbols
        printf("Enter number of symbols\t: ");
        n = 5;
        printf("%d\n", n);
    
        // Input symbols
        for (i = 0; i < n; i++) {
            printf("Enter symbol %d : ", i + 1);
            ch = 'A' + i;
            printf("%c\n", ch);
    
            // Insert the symbol to the node
            p[i].sym = ch;
        }
    
        // Input probability of symbols
        float x[] = { 0.48, 0.16, 0.12, 0.12, 0.08 };
        for (i = 0; i < n; i++) {
            printf("\nEnter probability of %c : ", p[i].sym);
            printf("%.2f\n", x[i]);
    
            // Insert the value to node
            p[i].pro = x[i];
            total = total + p[i].pro;
    
            // checking max probability
            if (total > 1) {
                printf("Invalid. Enter new values");
                total = total - p[i].pro;
                i--;
            }
        }
    
        p[i].pro = 1 - total;
    
        // Sorting the symbols based on
        // their probability or frequency
        sortByProbability(n, p);
    
        for (i = 0; i < n; i++)
            p[i].top = -1;
    
        // Find the Shannon code
        shannon(0, n - 1, p);
    
        // Display the codes
        display(n, p);
        return 0;
    }
    